(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class l{normalize(t){const e=this.tokenize(t),r=this.parse(e),s=this.canonicalize(r);return this.serialize(s)}tokenize(t){return t.match(/(\d+|\(|\)|\+|\-|\*|\/)/g)||[]}parse(t){let e=0;const r=()=>{let n=s();for(;e<t.length&&(t[e]==="+"||t[e]==="-");){const a=t[e++],c=s();n={type:"binary",op:a,left:n,right:c}}return n},s=()=>{let n=o();for(;e<t.length&&(t[e]==="*"||t[e]==="/");){const a=t[e++],c=o();n={type:"binary",op:a,left:n,right:c}}return n},o=()=>{const n=t[e++];if(n==="("){const a=r();return e++,a}return{type:"number",value:parseInt(n,10)}};return r()}canonicalize(t){if(t.type==="number")return t;if(t.op==="+"||t.op==="-"){const r=this.flattenSum(t,1).map(s=>({...s,node:this.canonicalize(s.node)}));return r.sort(this.compareTerms),{type:"sum",terms:r}}if(t.op==="*"||t.op==="/"){const r=this.flattenProduct(t,!1).map(s=>({...s,node:this.canonicalize(s.node)}));return r.sort(this.compareFactors),{type:"product",factors:r}}return t}flattenSum(t,e){return t.type==="number"?[{node:t,sign:e}]:t.type==="binary"?t.op==="+"?[...this.flattenSum(t.left,e),...this.flattenSum(t.right,e)]:t.op==="-"?[...this.flattenSum(t.left,e),...this.flattenSum(t.right,-e)]:[{node:t,sign:e}]:[{node:t,sign:e}]}flattenProduct(t,e){return t.type==="number"?[{node:t,inverse:e}]:t.type==="binary"?t.op==="*"?[...this.flattenProduct(t.left,e),...this.flattenProduct(t.right,e)]:t.op==="/"?[...this.flattenProduct(t.left,e),...this.flattenProduct(t.right,!e)]:[{node:t,inverse:e}]:[{node:t,inverse:e}]}compareTerms(t,e){const r=l.serializeNode(t.node),s=l.serializeNode(e.node);return r<s?-1:r>s?1:e.sign-t.sign}compareFactors(t,e){const r=l.serializeNode(t.node),s=l.serializeNode(e.node);return r<s?-1:r>s?1:(t.inverse?1:0)-(e.inverse?1:0)}serialize(t){return l.serializeNode(t)}static serializeNode(t){return t.type==="number"?t.value.toString():t.type==="sum"?`Sum(${t.terms.map(s=>(s.sign>0?"+":"-")+l.serializeNode(s.node)).join(",")})`:t.type==="product"?`Prod(${t.factors.map(s=>(s.inverse?"/":"*")+l.serializeNode(s.node)).join(",")})`:""}}class O{constructor(){this.target=24,this.solutions=[]}solve(t){if(this.solutions=[],t.length!==4)return[];this.foundSolutions=new Set;const e=t.map(n=>({value:n,expr:n.toString(),prec:3}));this._search(e);const r=[],s=new Set,o=new l;for(const n of this.foundSolutions)try{const a=o.normalize(n);s.has(a)||(s.add(a),r.push(n))}catch(a){console.warn("Failed to normalize:",n,a),r.push(n)}return r}_search(t){if(t.length===1){Math.abs(t[0].value-this.target)<1e-6&&this.foundSolutions.add(t[0].expr);return}for(let e=0;e<t.length;e++)for(let r=0;r<t.length;r++){if(e===r)continue;const s=t[e],o=t[r],n=t.filter((a,c)=>c!==e&&c!==r);this._tryOp(s,o,"+",n),this._tryOp(s,o,"-",n),this._tryOp(s,o,"*",n),o.value!==0&&s.value%o.value===0&&this._tryOp(s,o,"/",n)}}_tryOp(t,e,r,s){let o=0;switch(r){case"+":o=t.value+e.value;break;case"-":o=t.value-e.value;break;case"*":o=t.value*e.value;break;case"/":o=t.value/e.value;break}const a={"+":1,"-":1,"*":2,"/":2}[r],c=(h,B=!1)=>{let g=h.expr,p=!1;return(h.prec<a||h.prec===a&&B&&(r==="-"||r==="/"))&&(p=!0),p?`(${g})`:g},L=c(t,!1),P=c(e,!0),w=`${L} ${r} ${P}`,z={value:o,expr:w,prec:a};this._search([...s,z])}}class x{constructor(){this.solver=new O}generate(){let t,e;do t=Array.from({length:4},()=>Math.floor(Math.random()*13)+1),e=this.solver.solve(t);while(e.length===0);return{numbers:t,solutions:e}}}const $=new x,y=document.getElementById("cards-container"),C=document.getElementById("refresh-btn"),T=document.getElementById("solve-btn"),f=document.getElementById("solutions-panel"),b=document.getElementById("solutions-list"),F=document.getElementById("solution-count"),I=document.getElementById("mascot-message");let m=[],u=!1;const v=["♥","♦","♣","♠"],N=()=>v[Math.floor(Math.random()*v.length)],A=i=>i==="♥"||i==="♦",j=i=>i===1?"A":i===11?"J":i===12?"Q":i===13?"K":i.toString(),S=["动动脑筋，在这个小脑袋里算一算！","不要偷看答案，除非你真的试过了！","算错了没关系，再试一次！","你是最棒的数学小天才！","想想看，有什么办法能凑成24？"];function E(){const{numbers:i,solutions:t}=$.generate();m=t,H(i),q(),d("新的题目来了！加油！")}function H(i){y.innerHTML="",i.forEach((t,e)=>{const r=N(),s=j(t),o=A(r)?"red":"black",n=document.createElement("div");n.className=`card ${o}`,n.style.animation=`bounce 0.5s ease ${e*.1}s`,n.innerHTML=`
      <div class="suit top-left">${r}</div>
      <div class="number">${s}</div>
      <div class="suit bottom-right">${r}</div>
    `,y.appendChild(n)})}function q(){u=!1,f.classList.remove("visible"),f.classList.add("hidden"),b.innerHTML="",F.textContent=m.length}function G(){if(u)return;const i=[...m].sort(()=>Math.random()-.5);b.innerHTML=i.map(t=>`<li>${t} = 24</li>`).join(""),f.classList.remove("hidden"),f.offsetWidth,f.classList.add("visible"),u=!0,d("这里是所有的解法，记住思路比答案更重要哦！")}function d(i){I.textContent=i;const t=document.querySelector(".mascot");t.style.animation="none",t.offsetWidth,t.style.animation="bounce 2s infinite"}function M(){if(!u){const i=S[Math.floor(Math.random()*S.length)];d(i)}}C.addEventListener("click",()=>{E(),M()});T.addEventListener("click",()=>{if(u){d("已经在显示答案啦！");return}G()});setInterval(()=>{u||M()},3e4);E();
