(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class l{normalize(e){const t=this.tokenize(e),o=this.parse(t),n=this.canonicalize(o);return this.serialize(n)}tokenize(e){return e.match(/(\d+|\(|\)|\+|\-|\*|\/)/g)||[]}parse(e){let t=0;const o=()=>{let s=n();for(;t<e.length&&(e[t]==="+"||e[t]==="-");){const a=e[t++],c=n();s={type:"binary",op:a,left:s,right:c}}return s},n=()=>{let s=r();for(;t<e.length&&(e[t]==="*"||e[t]==="/");){const a=e[t++],c=r();s={type:"binary",op:a,left:s,right:c}}return s},r=()=>{const s=e[t++];if(s==="("){const a=o();return t++,a}return{type:"number",value:parseInt(s,10)}};return o()}canonicalize(e){if(e.type==="number")return e;if(e.op==="+"||e.op==="-"){const o=this.flattenSum(e,1).map(n=>({...n,node:this.canonicalize(n.node)}));return o.sort((n,r)=>n.sign!==r.sign?r.sign-n.sign:this.compareTerms(n,r)),{type:"sum",terms:o}}if(e.op==="*"||e.op==="/"){const o=this.flattenProduct(e,!1).map(s=>{const a=this.canonicalize(s.node);let c=a,u=1;if(a.type==="sum"&&a.terms.length===2){const f=a.terms[0],d=a.terms[1];if(f.sign===1&&d.sign===-1||f.sign===-1&&d.sign===1){const h={type:"sum",terms:[{sign:1,node:f.node},{sign:-1,node:d.node}]},g={type:"sum",terms:[{sign:1,node:d.node},{sign:-1,node:f.node}]},F=l.serializeNode(h),b=l.serializeNode(g);F<b,c=h,u=1}}return{...s,node:c,factorSign:u}}),n=o.map(s=>{const a=l.serializeNode(s.node);let c=a;if(s.node.type==="sum"&&s.node.terms.length===2){const u=s.node.terms[0],d={type:"sum",terms:[{sign:1,node:s.node.terms[1].node},{sign:-1,node:u.node}]};c=l.serializeNode(d)}return[a,c].sort().join("|")});n.sort(),n.join("*");const r=o.map(s=>{let a=s.node;if(s.node.type==="sum"&&s.node.terms.length===2){const c=s.node.terms[0],u=s.node.terms[1],f=l.serializeNode(c.node),d=l.serializeNode(u.node);f<d&&(a={type:"sum",terms:[{sign:1,node:u.node},{sign:-1,node:c.node}]})}return{...s,node:a}});return r.sort((s,a)=>{const c=l.serializeNode(s.node),u=l.serializeNode(a.node);return c.localeCompare(u)}),{type:"product",factors:r}}return e}flattenSum(e,t){return e.type==="number"?[{node:e,sign:t}]:e.type==="binary"?e.op==="+"?[...this.flattenSum(e.left,t),...this.flattenSum(e.right,t)]:e.op==="-"?[...this.flattenSum(e.left,t),...this.flattenSum(e.right,-t)]:[{node:e,sign:t}]:[{node:e,sign:t}]}flattenProduct(e,t){return e.type==="number"?[{node:e,inverse:t,sign:1}]:e.type==="binary"?e.op==="*"?[...this.flattenProduct(e.left,t),...this.flattenProduct(e.right,t)]:e.op==="/"?[...this.flattenProduct(e.left,t),...this.flattenProduct(e.right,!t)]:[{node:e,inverse:t,sign:1}]:[{node:e,inverse:t,sign:1}]}compareTerms(e,t){const o=l.serializeNode(e.node),n=l.serializeNode(t.node);return o<n?-1:o>n?1:t.sign-e.sign}compareFactors(e,t){const o=l.serializeNode(e.node),n=l.serializeNode(t.node);return o<n?-1:o>n?1:(e.inverse?1:0)-(t.inverse?1:0)}serialize(e){return l.serializeNode(e)}static serializeNode(e){return e.type==="number"?e.value.toString():e.type==="sum"?`Sum(${e.terms.map(n=>(n.sign>0?"+":"-")+l.serializeNode(n.node)).join(",")})`:e.type==="product"?`Prod(${e.factors.map(n=>(n.inverse?"/":"*")+l.serializeNode(n.node)).join(",")})`:""}}class C{constructor(){this.target=24,this.solutions=[]}solve(e){if(this.solutions=[],e.length!==4)return[];this.foundSolutions=new Set;const t=e.map(s=>({value:s,expr:s.toString(),prec:3}));this._search(t);const o=[],n=new Set,r=new l;for(const s of this.foundSolutions)try{const a=r.normalize(s);n.has(a)||(n.add(a),o.push(s))}catch(a){console.warn("Failed to normalize:",s,a),o.push(s)}return o}_search(e){if(e.length===1){Math.abs(e[0].value-this.target)<1e-6&&this.foundSolutions.add(e[0].expr);return}for(let t=0;t<e.length;t++)for(let o=0;o<e.length;o++){if(t===o)continue;const n=e[t],r=e[o],s=e.filter((a,c)=>c!==t&&c!==o);this._tryOp(n,r,"+",s),this._tryOp(n,r,"-",s),this._tryOp(n,r,"*",s),r.value!==0&&n.value%r.value===0&&this._tryOp(n,r,"/",s)}}_tryOp(e,t,o,n){let r=0;switch(o){case"+":r=e.value+t.value;break;case"-":r=e.value-t.value;break;case"*":r=e.value*t.value;break;case"/":r=e.value/t.value;break}const a={"+":1,"-":1,"*":2,"/":2}[o],c=(g,F=!1)=>{let b=g.expr,T=!1;return(g.prec<a||g.prec===a&&F&&(o==="-"||o==="/"))&&(T=!0),T?`(${b})`:b},u=c(e,!1),f=c(t,!0),d=`${u} ${o} ${f}`,h={value:r,expr:d,prec:a};this._search([...n,h])}}class k{constructor(){this.solver=new C}generate(){let e,t;do e=Array.from({length:4},()=>Math.floor(Math.random()*13)+1),t=this.solver.solve(e);while(t.length===0);return{numbers:e,solutions:t}}}const I=new k,M=document.getElementById("cards-container"),A=document.getElementById("refresh-btn"),v=document.getElementById("solve-btn"),y=document.getElementById("solutions-panel"),N=document.getElementById("solutions-list"),j=document.getElementById("solution-count"),H=document.getElementById("mascot-message"),K=document.getElementById("anti-rote-tip");let x=[],m=!1,S=[],w=!1,p=!1;const z=["♥","♦","♣","♠"],Q=()=>z[Math.floor(Math.random()*z.length)],R=i=>i==="♥"||i==="♦",q=i=>i===1?"A":i===11?"J":i===12?"Q":i===13?"K":i.toString(),G=i=>i===11?"11":i===12?"12":i===13?"13":i.toString(),U=i=>{L(),p=!1,i.forEach(e=>{V(G(e))})},B=["动动脑筋，在这个小脑袋里算一算！","不要偷看答案，除非你真的试过了！","算错了没关系，再试一次！","你是最棒的数学小天才！","想想看，有什么办法能凑成24？"];function W(i){let e=i.replace(/[\u{1F000}-\u{1F6FF}\u{1F900}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu,"");return e=e.replace(/\+/g,"加").replace(/-/g,"减").replace(/\*/g,"乘").replace(/\//g,"除").replace(/=/g,"等于"),e}function P(i,e=1,t=1,o=1){const n=W(i);return new Promise(r=>{const s=new SpeechSynthesisUtterance(n);s.rate=e,s.pitch=t,s.volume=o,s.lang="zh-CN",s.onend=()=>r(),s.onerror=()=>r(),speechSynthesis.speak(s)})}async function J(){if(!(w||S.length===0||p)){for(w=!0;S.length>0&&!p;){const i=S.shift();await P(i),await new Promise(e=>setTimeout(e,300))}w=!1}}function V(i){S.push(i),J()}function L(){speechSynthesis.cancel(),S=[],w=!1,p=!0}function O(){L();const{numbers:i,solutions:e}=I.generate();x=e,D(i),X(),E("新的题目来了！加油！"),setTimeout(()=>{U(i)},1e3)}function D(i){M.innerHTML="",i.forEach((e,t)=>{const o=Q(),n=q(e),r=R(o)?"red":"black",s=document.createElement("div");s.className=`card ${r}`,s.style.animation=`bounce 0.5s ease ${t*.1}s`,s.innerHTML=`
      <div class="suit top-left">${o}</div>
      <div class="number">${n}</div>
      <div class="suit bottom-right">${o}</div>
    `,M.appendChild(s)})}function X(){m=!1,y.classList.remove("visible"),y.classList.add("hidden"),N.innerHTML="",j.textContent=x.length,v.disabled=!1,v.classList.remove("disabled")}function Y(){if(m)return;v.disabled=!0,v.classList.add("disabled");const i=[...x].sort(()=>Math.random()-.5);N.innerHTML=i.map(t=>`<li>${t} = 24</li>`).join(""),y.classList.remove("hidden"),y.offsetWidth,y.classList.add("visible"),m=!0,E("这里是所有的解法，记住思路比答案更重要哦！"),(async()=>{L(),p=!1;for(const t of i){if(p||(await P(`${t}等于24`),p))break;await new Promise(o=>setTimeout(o,500))}p||(await new Promise(t=>setTimeout(t,1e3)),!p&&await P(K.textContent))})()}function E(i){H.textContent=i;const e=document.querySelector(".mascot");e.style.animation="none",e.offsetWidth,e.style.animation="bounce 2s infinite"}function $(){if(!m){const i=B[Math.floor(Math.random()*B.length)];E(i)}}A.addEventListener("click",()=>{O(),$()});v.addEventListener("click",()=>{if(m){E("已经在显示答案啦！");return}Y()});setInterval(()=>{m||$()},3e4);O();
