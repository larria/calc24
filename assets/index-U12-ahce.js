(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class l{normalize(e){const t=this.tokenize(e),n=this.parse(t),s=this.canonicalize(n);return this.serialize(s)}tokenize(e){return e.match(/(\d+|\(|\)|\+|\-|\*|\/)/g)||[]}parse(e){let t=0;const n=()=>{let r=s();for(;t<e.length&&(e[t]==="+"||e[t]==="-");){const a=e[t++],c=s();r={type:"binary",op:a,left:r,right:c}}return r},s=()=>{let r=i();for(;t<e.length&&(e[t]==="*"||e[t]==="/");){const a=e[t++],c=i();r={type:"binary",op:a,left:r,right:c}}return r},i=()=>{const r=e[t++];if(r==="("){const a=n();return t++,a}return{type:"number",value:parseInt(r,10)}};return n()}canonicalize(e){if(e.type==="number")return e;if(e.op==="+"||e.op==="-"){const n=this.flattenSum(e,1).map(s=>({...s,node:this.canonicalize(s.node)}));return n.sort(this.compareTerms),{type:"sum",terms:n}}if(e.op==="*"||e.op==="/"){const n=this.flattenProduct(e,!1).map(s=>({...s,node:this.canonicalize(s.node)}));return n.sort(this.compareFactors),{type:"product",factors:n}}return e}flattenSum(e,t){return e.type==="number"?[{node:e,sign:t}]:e.type==="binary"?e.op==="+"?[...this.flattenSum(e.left,t),...this.flattenSum(e.right,t)]:e.op==="-"?[...this.flattenSum(e.left,t),...this.flattenSum(e.right,-t)]:[{node:e,sign:t}]:[{node:e,sign:t}]}flattenProduct(e,t){return e.type==="number"?[{node:e,inverse:t}]:e.type==="binary"?e.op==="*"?[...this.flattenProduct(e.left,t),...this.flattenProduct(e.right,t)]:e.op==="/"?[...this.flattenProduct(e.left,t),...this.flattenProduct(e.right,!t)]:[{node:e,inverse:t}]:[{node:e,inverse:t}]}compareTerms(e,t){const n=l.serializeNode(e.node),s=l.serializeNode(t.node);return n<s?-1:n>s?1:t.sign-e.sign}compareFactors(e,t){const n=l.serializeNode(e.node),s=l.serializeNode(t.node);return n<s?-1:n>s?1:(e.inverse?1:0)-(t.inverse?1:0)}serialize(e){return l.serializeNode(e)}static serializeNode(e){return e.type==="number"?e.value.toString():e.type==="sum"?`Sum(${e.terms.map(s=>(s.sign>0?"+":"-")+l.serializeNode(s.node)).join(",")})`:e.type==="product"?`Prod(${e.factors.map(s=>(s.inverse?"/":"*")+l.serializeNode(s.node)).join(",")})`:""}}class N{constructor(){this.target=24,this.solutions=[]}solve(e){if(this.solutions=[],e.length!==4)return[];this.foundSolutions=new Set;const t=e.map(r=>({value:r,expr:r.toString(),prec:3}));this._search(t);const n=[],s=new Set,i=new l;for(const r of this.foundSolutions)try{const a=i.normalize(r);s.has(a)||(s.add(a),n.push(r))}catch(a){console.warn("Failed to normalize:",r,a),n.push(r)}return n}_search(e){if(e.length===1){Math.abs(e[0].value-this.target)<1e-6&&this.foundSolutions.add(e[0].expr);return}for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++){if(t===n)continue;const s=e[t],i=e[n],r=e.filter((a,c)=>c!==t&&c!==n);this._tryOp(s,i,"+",r),this._tryOp(s,i,"-",r),this._tryOp(s,i,"*",r),i.value!==0&&s.value%i.value===0&&this._tryOp(s,i,"/",r)}}_tryOp(e,t,n,s){let i=0;switch(n){case"+":i=e.value+t.value;break;case"-":i=e.value-t.value;break;case"*":i=e.value*t.value;break;case"/":i=e.value/t.value;break}const a={"+":1,"-":1,"*":2,"/":2}[n],c=(y,C=!1)=>{let E=y.expr,v=!1;return(y.prec<a||y.prec===a&&C&&(n==="-"||n==="/"))&&(v=!0),v?`(${E})`:E},z=c(e,!1),B=c(t,!0),O=`${z} ${n} ${B}`,$={value:i,expr:O,prec:a};this._search([...s,$])}}class I{constructor(){this.solver=new N}generate(){let e,t;do e=Array.from({length:4},()=>Math.floor(Math.random()*13)+1),t=this.solver.solve(e);while(t.length===0);return{numbers:e,solutions:t}}}const k=new I,T=document.getElementById("cards-container"),A=document.getElementById("refresh-btn"),d=document.getElementById("solve-btn"),p=document.getElementById("solutions-panel"),L=document.getElementById("solutions-list"),j=document.getElementById("solution-count"),H=document.getElementById("mascot-message"),Q=document.getElementById("anti-rote-tip");let b=[],f=!1,h=[],m=!1,u=!1;const F=["♥","♦","♣","♠"],R=()=>F[Math.floor(Math.random()*F.length)],q=o=>o==="♥"||o==="♦",G=o=>o===1?"A":o===11?"J":o===12?"Q":o===13?"K":o.toString(),K=o=>o===11?"11":o===12?"12":o===13?"13":o.toString(),U=o=>{w(),u=!1,o.forEach(e=>{J(K(e))})},P=["动动脑筋，在这个小脑袋里算一算！","不要偷看答案，除非你真的试过了！","算错了没关系，再试一次！","你是最棒的数学小天才！","想想看，有什么办法能凑成24？"];function W(o){let e=o.replace(/[\u{1F000}-\u{1F6FF}\u{1F900}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu,"");return e=e.replace(/\+/g,"加").replace(/-/g,"减").replace(/\*/g,"乘").replace(/\//g,"除").replace(/=/g,"等于"),e}function S(o,e=1,t=1,n=1){const s=W(o);return new Promise(i=>{const r=new SpeechSynthesisUtterance(s);r.rate=e,r.pitch=t,r.volume=n,r.lang="zh-CN",r.onend=()=>i(),r.onerror=()=>i(),speechSynthesis.speak(r)})}async function _(){if(!(m||h.length===0||u)){for(m=!0;h.length>0&&!u;){const o=h.shift();await S(o),await new Promise(e=>setTimeout(e,300))}m=!1}}function J(o){h.push(o),_()}function w(){speechSynthesis.cancel(),h=[],m=!1,u=!0}function M(){w();const{numbers:o,solutions:e}=k.generate();b=e,V(o),D(),g("新的题目来了！加油！"),setTimeout(()=>{U(o)},1e3)}function V(o){T.innerHTML="",o.forEach((e,t)=>{const n=R(),s=G(e),i=q(n)?"red":"black",r=document.createElement("div");r.className=`card ${i}`,r.style.animation=`bounce 0.5s ease ${t*.1}s`,r.innerHTML=`
      <div class="suit top-left">${n}</div>
      <div class="number">${s}</div>
      <div class="suit bottom-right">${n}</div>
    `,T.appendChild(r)})}function D(){f=!1,p.classList.remove("visible"),p.classList.add("hidden"),L.innerHTML="",j.textContent=b.length,d.disabled=!1,d.classList.remove("disabled")}function X(){if(f)return;d.disabled=!0,d.classList.add("disabled");const o=[...b].sort(()=>Math.random()-.5);L.innerHTML=o.map(t=>`<li>${t} = 24</li>`).join(""),p.classList.remove("hidden"),p.offsetWidth,p.classList.add("visible"),f=!0,g("这里是所有的解法，记住思路比答案更重要哦！"),(async()=>{w(),u=!1;for(const t of o){if(u||(await S(`${t}等于24`),u))break;await new Promise(n=>setTimeout(n,500))}u||(await new Promise(t=>setTimeout(t,1e3)),!u&&await S(Q.textContent))})()}function g(o){H.textContent=o;const e=document.querySelector(".mascot");e.style.animation="none",e.offsetWidth,e.style.animation="bounce 2s infinite"}function x(){if(!f){const o=P[Math.floor(Math.random()*P.length)];g(o)}}A.addEventListener("click",()=>{M(),x()});d.addEventListener("click",()=>{if(f){g("已经在显示答案啦！");return}X()});setInterval(()=>{f||x()},3e4);M();
