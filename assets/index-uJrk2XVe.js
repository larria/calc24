(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class l{normalize(t){const e=this.tokenize(t),n=this.parse(e),s=this.canonicalize(n);return this.serialize(s)}tokenize(t){return t.match(/(\d+|\(|\)|\+|\-|\*|\/)/g)||[]}parse(t){let e=0;const n=()=>{let r=s();for(;e<t.length&&(t[e]==="+"||t[e]==="-");){const a=t[e++],c=s();r={type:"binary",op:a,left:r,right:c}}return r},s=()=>{let r=o();for(;e<t.length&&(t[e]==="*"||t[e]==="/");){const a=t[e++],c=o();r={type:"binary",op:a,left:r,right:c}}return r},o=()=>{const r=t[e++];if(r==="("){const a=n();return e++,a}return{type:"number",value:parseInt(r,10)}};return n()}canonicalize(t){if(t.type==="number")return t;if(t.op==="+"||t.op==="-"){const n=this.flattenSum(t,1).map(s=>({...s,node:this.canonicalize(s.node)}));return n.sort(this.compareTerms),{type:"sum",terms:n}}if(t.op==="*"||t.op==="/"){const n=this.flattenProduct(t,!1).map(s=>({...s,node:this.canonicalize(s.node)}));return n.sort(this.compareFactors),{type:"product",factors:n}}return t}flattenSum(t,e){return t.type==="number"?[{node:t,sign:e}]:t.type==="binary"?t.op==="+"?[...this.flattenSum(t.left,e),...this.flattenSum(t.right,e)]:t.op==="-"?[...this.flattenSum(t.left,e),...this.flattenSum(t.right,-e)]:[{node:t,sign:e}]:[{node:t,sign:e}]}flattenProduct(t,e){return t.type==="number"?[{node:t,inverse:e}]:t.type==="binary"?t.op==="*"?[...this.flattenProduct(t.left,e),...this.flattenProduct(t.right,e)]:t.op==="/"?[...this.flattenProduct(t.left,e),...this.flattenProduct(t.right,!e)]:[{node:t,inverse:e}]:[{node:t,inverse:e}]}compareTerms(t,e){const n=l.serializeNode(t.node),s=l.serializeNode(e.node);return n<s?-1:n>s?1:e.sign-t.sign}compareFactors(t,e){const n=l.serializeNode(t.node),s=l.serializeNode(e.node);return n<s?-1:n>s?1:(t.inverse?1:0)-(e.inverse?1:0)}serialize(t){return l.serializeNode(t)}static serializeNode(t){return t.type==="number"?t.value.toString():t.type==="sum"?`Sum(${t.terms.map(s=>(s.sign>0?"+":"-")+l.serializeNode(s.node)).join(",")})`:t.type==="product"?`Prod(${t.factors.map(s=>(s.inverse?"/":"*")+l.serializeNode(s.node)).join(",")})`:""}}class ${constructor(){this.target=24,this.solutions=[]}solve(t){if(this.solutions=[],t.length!==4)return[];this.foundSolutions=new Set;const e=t.map(r=>({value:r,expr:r.toString(),prec:3}));this._search(e);const n=[],s=new Set,o=new l;for(const r of this.foundSolutions)try{const a=o.normalize(r);s.has(a)||(s.add(a),n.push(r))}catch(a){console.warn("Failed to normalize:",r,a),n.push(r)}return n}_search(t){if(t.length===1){Math.abs(t[0].value-this.target)<1e-6&&this.foundSolutions.add(t[0].expr);return}for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++){if(e===n)continue;const s=t[e],o=t[n],r=t.filter((a,c)=>c!==e&&c!==n);this._tryOp(s,o,"+",r),this._tryOp(s,o,"-",r),this._tryOp(s,o,"*",r),o.value!==0&&s.value%o.value===0&&this._tryOp(s,o,"/",r)}}_tryOp(t,e,n,s){let o=0;switch(n){case"+":o=t.value+e.value;break;case"-":o=t.value-e.value;break;case"*":o=t.value*e.value;break;case"/":o=t.value/e.value;break}const a={"+":1,"-":1,"*":2,"/":2}[n],c=(m,O=!1)=>{let v=m.expr,g=!1;return(m.prec<a||m.prec===a&&O&&(n==="-"||n==="/"))&&(g=!0),g?`(${v})`:v},T=c(t,!1),x=c(e,!0),z=`${T} ${n} ${x}`,B={value:o,expr:z,prec:a};this._search([...s,B])}}class C{constructor(){this.solver=new $}generate(){let t,e;do t=Array.from({length:4},()=>Math.floor(Math.random()*13)+1),e=this.solver.solve(t);while(e.length===0);return{numbers:t,solutions:e}}}const I=new C,S=document.getElementById("cards-container"),N=document.getElementById("refresh-btn"),d=document.getElementById("solve-btn"),p=document.getElementById("solutions-panel"),F=document.getElementById("solutions-list"),A=document.getElementById("solution-count"),k=document.getElementById("mascot-message"),j=document.getElementById("anti-rote-tip");let y=[],f=!1,u=!1;const b=["♥","♦","♣","♠"],H=()=>b[Math.floor(Math.random()*b.length)],R=i=>i==="♥"||i==="♦",q=i=>i===1?"A":i===11?"J":i===12?"Q":i===13?"K":i.toString(),w=["动动脑筋，在这个小脑袋里算一算！","不要偷看答案，除非你真的试过了！","算错了没关系，再试一次！","你是最棒的数学小天才！","想想看，有什么办法能凑成24？"];function G(i){let t=i.replace(/[\u{1F000}-\u{1F6FF}\u{1F900}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu,"");return t=t.replace(/\+/g,"加").replace(/-/g,"减").replace(/\*/g,"乘").replace(/\//g,"除").replace(/=/g,"等于"),t}function E(i,t=1,e=1,n=1){const s=G(i);return new Promise(o=>{const r=new SpeechSynthesisUtterance(s);r.rate=t,r.pitch=e,r.volume=n,r.lang="zh-CN",r.onend=()=>o(),r.onerror=()=>o(),speechSynthesis.speak(r)})}function P(){speechSynthesis.cancel(),u=!0}function L(){P();const{numbers:i,solutions:t}=I.generate();y=t,K(i),U(),h("新的题目来了！加油！")}function K(i){S.innerHTML="",i.forEach((t,e)=>{const n=H(),s=q(t),o=R(n)?"red":"black",r=document.createElement("div");r.className=`card ${o}`,r.style.animation=`bounce 0.5s ease ${e*.1}s`,r.innerHTML=`
      <div class="suit top-left">${n}</div>
      <div class="number">${s}</div>
      <div class="suit bottom-right">${n}</div>
    `,S.appendChild(r)})}function U(){f=!1,p.classList.remove("visible"),p.classList.add("hidden"),F.innerHTML="",A.textContent=y.length,d.disabled=!1,d.classList.remove("disabled")}function W(){if(f)return;d.disabled=!0,d.classList.add("disabled");const i=[...y].sort(()=>Math.random()-.5);F.innerHTML=i.map(e=>`<li>${e} = 24</li>`).join(""),p.classList.remove("hidden"),p.offsetWidth,p.classList.add("visible"),f=!0,h("这里是所有的解法，记住思路比答案更重要哦！"),(async()=>{P(),u=!1;for(const e of i){if(u||(await E(`${e}等于24`),u))break;await new Promise(n=>setTimeout(n,500))}u||(await new Promise(e=>setTimeout(e,1e3)),!u&&await E(j.textContent))})()}function h(i){k.textContent=i;const t=document.querySelector(".mascot");t.style.animation="none",t.offsetWidth,t.style.animation="bounce 2s infinite"}function M(){if(!f){const i=w[Math.floor(Math.random()*w.length)];h(i)}}N.addEventListener("click",()=>{L(),M()});d.addEventListener("click",()=>{if(f){h("已经在显示答案啦！");return}W()});setInterval(()=>{f||M()},3e4);L();
